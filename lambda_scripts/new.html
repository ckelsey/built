<script>
    var WCConstructor = window.builtjs.WCConstructor
    var WCDefine = window.builtjs.WCDefine
    var ObserveEvent = window.builtjs.ObserveEvent

    var componentName = 'test-element'
    var componentRoot = '.' + componentName + '-container'
    var style = ':host(' + componentName + '){display:block;}' + componentName + '{display:block;}'
    var template = '<div class="' + componentName + '-container">' +
        '<form id="loginform" method="POST" name="login" action="https://api.cklsylabs.com/built">' +
        '<input-field id="username" name="username" label="username" required="true" autocomplete="username"></input-field>' +
        '<input-field id="current-password" name="current-password" label="password" required="true" autocomplete="current-password" type="password"></input-field>' +
        '<button-element type="submit">Submit</button-element>' +
        '</form>' +
        '</div>'


    var elements = {
        root: { selector: componentRoot, },
        button: { selector: 'button-element', onChange(el, host) { el.addEventListener('click', function () { host.elements.form.dispatchEvent(new Event('submit')) }) } },
        password: { selector: '#current-password' },
        username: { selector: '#username' },
        form: {
            selector: '#loginform',
            onChange: function (el, host) {
                el.eventListeners = {
                    submit: ObserveEvent(el, 'submit', { preventDefault: true })
                        .subscribe(function () {
                            var formData = new FormData(el)
                            var data = {}
                            formData.forEach(function (value, key) { data[key] = value })
                            var xhr = new XMLHttpRequest()
                            xhr.addEventListener("load", function () { location.reload() });
                            xhr.open(el.method, el.action);
                            xhr.send(JSON.stringify(data))
                        })
                }
            }
        }
    }

    var TestElement = WCConstructor({
        componentName,
        componentRoot,
        template,
        style,
        elements
    })

    WCDefine(componentName, TestElement)
</script>
